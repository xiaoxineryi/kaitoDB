# 数据库开发作业一

## 基本设计

块与页之间的关系，块是管理的基本单位，但是与内存的交互中页是基本单位。



参考`postgreSQL`来进行设计，所有的数据(包括数据库、模式、表等)都统一使用`OID`来进行标识，首先是数据库簇，这里保存所有的建立的数据库信息，也就是`pg_database`的一个集合，同时，系统还维护一个统一的表空间数组，每一个表空间里存放对应表的各种信息，比如类型信息、名字、存储位置等。我觉得可能每一个数据库`pg_database`里进行存储一个表空间数组`pg_tablespace[]`也是可以的。

表空间里面除了存放最基本的各项信息，这些统一可以作为`pg_class`对象进行表示以外，还需要存放里面有多少块、块的位置之类的信息。

因为在设计的时候，我们可以使用什么样的数据应该是确定的，所以系统还会维护一个`pg_type`表，来记录每一种类型的各种属性。

有了支持的基本类型，我们就可以给各种字段进行设置属性了，比如`student`中的`name`是`varchar(10)`之类的表示形式，这样，除了基本类型以外，还有一些问题就是，能不能空，是否是主键、该属性对应于哪个表等等的信息还需额外记录，因此我们使用`pg_attribute`来记录每一个表中不同的属性信息。



这样保存之类的就可以做了，读取的时候，读取到缓冲区以后，可以根据数据对应的表的各种信息，进行处理，从而得到对象的链表。



## 一、系统表设计

系统表在第一次运行的时候会被创建，以后再次运行会直接在对应的位置上进行查找并读取相应的数据来生成系统表。

在不考虑缓冲`buffer`的情况下，有如下的基本想法：

+ 需要有一个文件统一地存放所有的数据库信息，其中包括数据库路径、当前`OID`大小、编码格式等等的信息，这些统一地存放在`pg_global`表中。该文件在程序运行时就读入到内存中。
+ 在一开始，我们就规定好所有可能的类型·，包括`varchar`、`int`、`date`等等一些基本类型，将之存放在`pg_type`中，在系统运行时读取。
+ 这里不考虑像`mysq`、`db2`等可以新建多个数据库，每个数据库中同名表等不会冲突等情况，在此我们假设只有一个统一的数据库，所有的表都位于该数据库下，则假设该表为`pg_database`，里面存放该数据库的基本信息，如数据库名字、编码格式、表空间的`oid`等的数组等信息。
+ 在这里，我的设计是每一个表空间对应多个表，所以对于每一个表空间`pg_tablespace`来说，都要有一个对应的地址来表明该表空间对应的物理空间，同时记录其对应的所有表信息，包括对应表的`OID`之类的
+ 每一个表记为`pg_table`，里面会存放该表的名字、`OID`、各种列的属性、约束总数等等的信息。
+ 每一个属性，记为`pg_attribute`，他不仅有自己的`OID`,还有属性名、约束、类型之类的信息。



### 1. 全局信息设计

`global`中存放全局信息，包括当前的`OID`、默认存放的路径、数据库数目的信息。

### 2.基本数据类型设计

`kb_type`存放所有的数据类型，本次设计支持的数据类型有：`i32`、`u32`、`float`、`char(n)`、`varchar(n)`。

